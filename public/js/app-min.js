"use strict";function fbLogin(){loginType="fb",FB.login(function(e){"connected"===e.status?FB.api("/me","GET",{fields:"name,id,picture.width(300).height(300),email,hometown,gender,birthday"},function(e){var t=Math.floor((Date.now()-Date.parse(e.birthday))/315144e5);$.post("http://localhost:8000/api/users/",{email:e.id+"@com",username:e.name,userPhoto:e.picture.data.url,homeTown:e.hometown.name,gender:e.gender,age:t,password:"pass"}),$.get("http://localhost:8000/api/users/"+e.id+"@com",function(e){document.cookie="email="+e.email,document.cookie="password="+e.password,document.cookie="username="+e.username,document.cookie="age="+e.age,document.cookie="phone="+e.phone,document.cookie="homeTown="+e.homeTown,document.cookie="gender="+e.gender,document.cookie="subscribed="+e.subscribed,document.cookie="createdEvents="+e.createdEvents,document.cookie="userPhoto="+e.userPhoto})}):"not_authorized"===e.status?console.log("You are not logged in."):console.log("You are not logged in facebook.")})}function fbLogout(){FB.logout(function(e){console.log("FB user logged out"),loginType="none"})}function initClient(){gapi.load("auth2",function(){auth2=gapi.auth2.init({client_id:"828555280883-gnki4fgfl5p1lss9froaa6u8n77bld8j.apps.googleusercontent.com",cookiepolicy:"single_host_origin"}),attachSignin(document.getElementById("g_l"))})}function attachSignin(e){auth2.attachClickHandler(e,{},onSuccess,onFailure)}function onSuccess(e){loginType="g";var t=e.getBasicProfile();$.post("http://localhost:8000/api/users/",{email:""+t.getEmail(),username:""+t.getName(),userPhoto:""+t.getImageUrl(),password:"somePassword"}),$.get("http://localhost:8000/api/users/"+t.getEmail(),function(e){document.cookie="email="+e.email,document.cookie="password="+e.password,document.cookie="username="+e.username,document.cookie="age="+e.age,document.cookie="phone="+e.phone,document.cookie="homeTown="+e.homeTown,document.cookie="gender="+e.gender,document.cookie="subscribed="+e.subscribed,document.cookie="createdEvents="+e.createdEvents,document.cookie="userPhoto="+e.userPhoto})}function onFailure(e){console.log(JSON.stringify(e,void 0,2))}function gSignout(){var e=gapi.auth2.getAuthInstance();e.signOut().then(function(){"g"===loginType?console.log("Google User signed out"):1,attachSignin(document.getElementById("g_l")),loginType="none"})}function injectWeather(e){var t=document.createElement("script");t.setAttribute("src","https://query.yahooapis.com/v1/public/yql?q=select * from weather.forecast where woeid in (select woeid from geo.places(1) where text='"+e+"')&format=json&callback=callbackFunction"),document.body.appendChild(t)}angular.module("mainApp",["router","ngAnimate","ngSanitize","ui.bootstrap"]).controller("aboutCtrl",function(e){e.myname="about"}).controller("errorCtrl",function(e){e.myname="about"}),angular.module("router",["ngRoute"]).config(function(e,t){e.when("/",{templateUrl:"general.html",controller:"generalCtrl"}).when("/event/:event_id",{templateUrl:"event.html",controller:"eventCtrl"}).when("/event_manage/:event_id",{templateUrl:"event_manage.html",controller:"event_manageCtrl"}).when("/home",{templateUrl:"home.html",controller:"homeCtrl"}).when("/about",{templateUrl:"about.html",controller:"aboutCtrl"}).when("/profile",{templateUrl:"profile.html",controller:"profileCtrl"}).when("/faq",{templateUrl:"faq.html",controller:"faqFindCtrl"}).when("/findus",{templateUrl:"find.html",controller:"faqFindCtrl"}).when("/event_manage",{templateUrl:"event_manage.html",controller:"event_manageCtrl"}).otherwise({templateUrl:"404.html",controller:"errorCtrl"}),t.html5Mode(!0)}),window.fbAsyncInit=function(){FB.init({appId:"211283292620723",xfbml:!0,status:!0,cookie:!0,version:"v2.7"})},function(e,t,o){var n,a=e.getElementsByTagName(t)[0];e.getElementById(o)||(n=e.createElement(t),n.id=o,n.src="//connect.facebook.net/en_US/sdk.js",a.parentNode.insertBefore(n,a))}(document,"script","facebook-jssdk"),angular.module("mainApp").directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,o,n){var a=e(n.fileModel),r=a.assign;o.bind("change",function(){t.$apply(function(){r(t,o[0].files[0])})})}}}]);var auth2,googleUser={},loginType="simple";initClient(),jQuery(document).ready(function(){if($(".cd-stretchy-nav").length>0){var e=$(".cd-stretchy-nav");e.each(function(){var e=$(this),t=e.find(".cd-nav-trigger");t.on("click",function(t){t.preventDefault(),e.toggleClass("nav-is-visible")})}),$(document).on("click",function(t){!$(t.target).is(".cd-nav-trigger")&&!$(t.target).is(".cd-nav-trigger span")&&e.removeClass("nav-is-visible")})}}),angular.module("mainApp").controller("EventController",["$scope","multipartForm","$uibModalInstance",function(e,t,o){e.submit=function(){var n="/api/events";t.post(n,e.event),o.close()},e.hstep=1,e.mstep=15,e.options={hstep:[1,2,3],mstep:[1,5,10,15,25,30]},e.update=function(){var t=new Date;t.setHours(14),t.setMinutes(0),e.time=t},e.options={showWeeks:!1},e.close=function(){o.close()}}]),angular.module("mainApp").controller("eventCtrl",["$scope","$http","cookieService","eventService",function(e,t,o,n){function a(e){$(".event-picture").css({"background-image":"url("+e+")",width:"100%",height:"400px"}),$(".upload_title").css({display:"none"})}e.similar=[],e.members=[];var r=location.pathname.slice(7);e.author="",e.pht="",t.get("/api/events/"+r).then(function(o){a(o.data.photoURL),o.data.time=o.data.time.substring(11,16),o.data.date=o.data.date.substring(0,10),e.event=angular.fromJson(o.data),injectWeather(e.event.place),t.get("/api/users/"+e.event.creator).then(function(t){e.author=t.data.username,e.pht=t.data.userPhoto}),n.getMembers(e);var r=setInterval(function(){if(void 0!=weather){console.log(weather),document.getElementById("weather").innerHTML=weather.title;for(var t=new Date(e.event.date),o=0,n=0;n<10;n++){var a=new Date(weather.item.forecast[n].date);if(t.toString().substring(0,15)==a.toString().substring(0,15)){var i=((+weather.item.forecast[n].high-32)/1.8).toFixed(0);document.getElementById("weather_temp").innerHTML=i+" <sup>o</sup>C";var c=weather.item.forecast[n].code;document.getElementById("weather_status").innerHTML=weather.item.forecast[n].text,o=1}}for(var s in weather_img)for(var u=0;u<weather_img[s].length;u++)weather_img[s][u]==c&&(document.getElementById("cloudy").style.display="inline-block");0===o&&(document.getElementById("weather_temp").innerHTML="Cannot find weather."),clearInterval(r)}else null===weather&&clearInterval(r)},500)}),t.get("/api/events").then(function(t){t.data.forEach(function(t){t.date=new Date(t.date).toDateString(),e.event.type===t.type&&e.event._id!==t._id&&e.similar.push(t)}),e.similar=e.similar.slice(0,4)}),e.email=o.getCookie("email"),e.gender=o.getCookie("gender"),e.age=o.getCookie("age"),e.phone=o.getCookie("phone"),e.homeTown=o.getCookie("homeTown"),e.subscribed=o.getCookie("subscribed")+(","+r),e.createdEvents=o.getCookie("createdEvents"),e.userPhoto=o.getCookie("userPhoto"),e.subscribe=function(){t.put("api/users/"+e.email,{age:e.age,gender:e.gender,phone:e.phone,homeTown:e.phone,subscribed:e.subscribed,createdEvents:e.createdEvents,userPhoto:e.userPhoto}),e.event.members+=","+e.email,t.put("/api/events/"+r,{name:e.event.name,place:e.event.place,date:e.event.date,time:e.event.time,type:e.event.type,payment:e.event.payment,description:e.event.description,photoURL:e.event.photoURL,members:e.event.members}),document.cookie="age="+e.age,document.cookie="phone="+e.phone,document.cookie="homeTown="+e.homeTown,document.cookie="gender="+e.gender,document.cookie="subscribed="+e.subscribed,document.cookie="createdEvents="+e.createdEvents,document.cookie="userPhoto="+e.userPhoto}}]),angular.module("mainApp").controller("event_manageCtrl",["$scope","$http","cookieService","eventService",function(e,t,o,n){function a(e){$(".event-picture").css({"background-image":"url("+e+")",width:"100%",height:"400px"})}var r=location.pathname.slice(14);e.members=[],e.place="",e.similar=[],e.author=o.getCookie("username"),e.pht=o.getCookie("userPhoto"),t.get("/api/events/"+r).then(function(t){injectWeather(t.data.place),t.data.time=t.data.time.substring(11,16),t.data.date=t.data.date.substring(0,10),a(t.data.photoURL),e.event=angular.fromJson(t.data),n.getMembers(e);var o=setInterval(function(){if(void 0!=weather){console.log(weather),document.getElementById("weather").innerHTML=weather.title;for(var t=new Date(e.event.date),n=0,a=0;a<10;a++){var r=new Date(weather.item.forecast[a].date);if(t.toString().substring(0,15)==r.toString().substring(0,15)){var i=((+weather.item.forecast[a].high-32)/1.8).toFixed(0);document.getElementById("weather_temp").innerHTML=i+" <sup>o</sup>C";var c=weather.item.forecast[a].code;document.getElementById("weather_status").innerHTML=weather.item.forecast[a].text,n=1}}for(var s in weather_img)for(var u=0;u<weather_img[s].length;u++)weather_img[s][u]==c&&(document.getElementById("cloudy").style.display="block");0===n&&(document.getElementById("weather_temp").innerHTML="Cannot find weather."),clearInterval(o)}else null===weather&&clearInterval(o)},500)}),t.get("/api/events").then(function(t){t.data.forEach(function(t){t.date=new Date(t.date).toDateString(),e.event.type===t.type&&e.event._id!==t._id&&e.similar.push(t)}),e.similar=e.similar.slice(0,4)}),e.change=function(){a(e.new_photo),t.put("/api/events/"+r,{name:e.event.name,place:e.event.place,date:e.event.date,time:e.event.time,type:e.event.type,payment:e.event.payment,description:e.event.description,photoURL:e.new_photo,members:e.event.members})},e.deleteReadonlyState=function(o){$("#"+o).attr("readonly")?$("#"+o).removeAttr("readonly"):($("#"+o).attr("readonly",""),t.put("/api/events/"+r,{name:e.event.name,place:e.event.place,date:e.event.date,time:e.event.time,type:e.event.type,payment:e.event.payment,description:e.event.description,photoURL:e.event.photoURL,members:e.event.members}))}}]),angular.module("mainApp").controller("faqFindCtrl",["$scope",function(e){}]),angular.module("mainApp").controller("generalCtrl",["$scope","$http","$uibModal","$sce","generalService",function(e,t,o,n,a){e.errorMsg="",e.gallery_cells=[];var r=[];t.get("/api/topevents").then(function(t){t.data.forEach(function(e){e.date=new Date(e.date).toDateString(),r.push(e)}),e.gallery_cells=a.modifyArr(r)}),e.postData=function(){e.user_password===e.user_repassword?t.post("http://localhost:8000/api/users/",{email:e.user_email,username:e.user_name,password:e.user_password}):(e.errorMsg="Confirmation failed!",e.user_password="",e.user_repassword="")},e.animationsEnabled=!0,e.event={name:"name",place:"place",payment:"type",dt:"date",time:"time",description:"text",file:""};var i;e.open=function(t,a,r){i=o.open({animation:this.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:n.trustAsResourceUrl(t),controller:r,sc:e,size:a}),e.openComponentModal=function(){o.open({animation:this.animationsEnabled,component:"modalComponent"})}}}]),angular.module("mainApp").controller("homeCtrl",function(e,t,o,n){var a=[],r=o.getCookie("email");t.get("api/events").then(function(e){var t="";e.data.forEach(function(e){e.date=new Date(e.date).toDateString(),e.creator===r&&(t+=","+e._id),a.push(e)}),document.cookie="createdEvents="+t}),e.evs=a,e.eventFilterBy={},e.currentPage=1,e.pageSize=6,e.itemsPerPage=e.pageSize,e.start,e.end,e.setItemsPerPage=function(t){e.itemsPerPage=t,e.currentPage=1},e.q="",e.getData=function(){return n("filter")(e.evs,e.q)},e.dateRangeFilter=function(e,t,o){return function(n){if(null===n[e])return!1;var a=moment(n[e]),r=moment(t,"DD-MM-YYYY"),i=moment(o,"DD-MM-YYYY");return a>=r&&a<=i}}}),angular.module("mainApp").filter("start",function(){return function(e,t){if(e&&e.length)return t=+t,e.slice(t)}}),angular.module("mainApp").controller("loginCtrl",["$scope","$http","$uibModal","$sce","$location","$uibModalInstance",function(e,t,o,n,a,r){e.getUser=function(){t.get("/api/users/"+e.email).then(function(e){document.cookie="email="+e.data.email,document.cookie="password="+e.data.password,document.cookie="username="+e.data.username,document.cookie="age="+e.data.age,document.cookie="phone="+e.data.phone,document.cookie="homeTown="+e.data.homeTown,document.cookie="gender="+e.data.gender,document.cookie="subscribed="+e.data.subscribed,document.cookie="createdEvents="+e.data.createdEvents,document.cookie="userPhoto="+e.data.userPhoto}),a.url("/home")},e.close=function(){r.close()}}]),angular.module("mainApp").controller("mainCtrl",["$scope","$http","$uibModal","$sce","$location",function(e,t,o,n,a){e.showLogin=function(){return"/"===location.pathname},e.visitHome=function(){a.url("/home")},e.visitAbout=function(){a.url("/about")},e.visitFAQ=function(){a.url("/faq")},e.visitFindUs=function(){a.url("/findus")},e.logout=function(){document.cookie="email=; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="password=; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="username=; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="age=; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="fullname=; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="phone=; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="homeTown=; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="gender=; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="subscribed=; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="createdEvents=; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="time=; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="userPhoto=; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="fblo_211283292620723=; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="G_AUTHUSER_H=; expires=Thu, 01 Jan 1970 00:00:00 UTC","fb"===loginType?fbLogout():1,gSignout(),a.url("/")},e.visitProfile=function(){a.url("/profile")},e.errorMsg="",e.getUser=function(){t.get("/api/users/"+e.email).then(function(e){document.cookie="email="+e.data.email,document.cookie="password="+e.data.password,document.cookie="username="+e.data.username,document.cookie="age="+e.data.age,document.cookie="phone="+e.data.phone,document.cookie="homeTown="+e.data.homeTown,document.cookie="gender="+e.data.gender,document.cookie="subscribed="+e.data.subscribed,document.cookie="createdEvents="+e.data.createdEvents,document.cookie="userPhoto="+e.data.userPhoto}),a.url("/home")},e.animationsEnabled=!0;var r;e.open=function(t,a,i){r=o.open({animation:this.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:n.trustAsResourceUrl(t),controller:i,sc:e,size:a}),e.openComponentModal=function(){o.open({animation:this.animationsEnabled,component:"modalComponent"})}}}]),angular.module("mainApp").controller("EventController",["$scope","multipartForm","$uibModalInstance","cookieService",function(e,t,o,n){e.submit=function(){var n="/api/events";t.post(n,e.event),o.close()},e.hstep=1,e.mstep=15,e.options={hstep:[1,2,3],mstep:[1,5,10,15,25,30]},e.update=function(){var t=new Date;t.setHours(14),t.setMinutes(0),e.time=t},e.options={showWeeks:!1},e.close=function(){o.close()}}]),angular.module("mainApp").controller("profileCtrl",function(e,t,o,n){function a(o){var n=[],a="",r=0;"subscribed"===o?a=e.subscribed:"created"===o&&(a=e.createdEvents),a=a.slice(1),n=a.split(",");for(var i=new Array(Math.ceil(n.length/3)),c=0;c<i.length;c++)i[c]={events:[]};for(var s=function(e){if(r>n.length-1)return"break";for(var o=0;o<3&&(t.get("api/events/"+n[r]).then(function(t){t.data.date=new Date(t.data.date).toDateString(),i[e].events.push(angular.fromJson(t.data))}),r+=1,!(r>n.length-1));o++);},u=0;u<i.length;u++){var l=s(u);if("break"===l)break}return i}e.getCookie=function(e){for(var t=document.cookie.split(";"),o="",n=0;n<t.length;n++)if(t[n].includes(e))for(var a=0;a<t[n].length;a++)"="===t[n][a]&&(o=t[n].substring(a+1));return"undefined"===o||"null"===o?"":o},e.email=e.getCookie("email"),e.gender=e.getCookie("gender"),e.age=e.getCookie("age"),e.phone=e.getCookie("phone"),e.homeTown=e.getCookie("homeTown"),e.subscribed=e.getCookie("subscribed"),e.userPhoto=e.getCookie("userPhoto"),console.log("pht",e.userPhoto),t.get("api/events").then(function(t){var o="";t.data.forEach(function(t){t.creator===e.email&&(o+=","+t._id)}),document.cookie="createdEvents="+o,e.createdEvents=e.getCookie("createdEvents"),e.created=a("created")}),e.subscr=a("subscribed"),e.putUserPhoto=function(){t.put("api/users/"+e.email,{age:e.age,gender:e.gender,phone:e.phone,homeTown:e.homeTown,subscribed:e.subscribed,createdEvents:e.createdEvents,userPhoto:e.userPhoto}),document.cookie="age="+e.age,document.cookie="phone="+e.phone,document.cookie="homeTown="+e.homeTown,document.cookie="gender="+e.gender,document.cookie="userPhoto="+e.userPhoto},e.deleteReadonlyState=function(o){$("#"+o).attr("readonly")?$("#"+o).removeAttr("readonly"):($("#"+o).attr("readonly",""),t.put("api/users/"+e.email,{age:e.age,gender:e.gender,phone:e.phone,homeTown:e.homeTown,subscribed:e.subscribed,createdEvents:e.createdEvents,userPhoto:e.userPhoto}),document.cookie="age="+e.age,document.cookie="phone="+e.phone,document.cookie="homeTown="+e.homeTown,document.cookie="gender="+e.gender)}}),angular.module("mainApp").controller("registController",["$scope","$http","$uibModal","$sce","$uibModalInstance",function(e,t,o,n,a){e.errorMsg="",t.get("/api/topevents").then(function(t){e.events=angular.fromJson(t.data)}),e.postData=function(){e.user_password===e.user_repassword?t.post("http://localhost:8000/api/users/",{email:e.user_email,username:e.user_name,password:e.user_password,userPhoto:""}):(e.errorMsg="Confirmation failed!",e.user_password="",e.user_repassword="")},e.close=function(){a.close()},e.event={name:"name",place:"place",payment:"type",dt:"date",time:"time",description:"text",photoURL:""}}]);var weather_img={lightning:[3,4,23],cloudy:[20,21,22,25,26,27,28,29,30,44,42],snow:[5,13,15,16,41,43,7,46],sunny:[32,36,34],rainy:[0,1,2,6,8,9,18,35]};angular.module("mainApp").service("cookieService",["$http",function(e){this.getCookie=function(e){for(var t=document.cookie.split(";"),o="",n=0;n<t.length;n++)if(t[n].includes(e))for(var a=0;a<t[n].length;a++)"="===t[n][a]&&(o=t[n].substring(a+1));return"undefined"===o?"":o}}]),angular.module("mainApp").service("eventService",["$http",function(e){this.getMembers=function(t){var o=t.event.members;if(""!=o&&void 0!=o&&"undefined"!=o){","===o[0]&&(o=o.slice(1)),o=o.split(",");for(var n=0;n<o.length;n++)"undefined"!==o[n]&&"null"!==o[n]||o.splice(n,1);console.log("mmm",o);for(var a=0;a<o.length;a++)e.get("/api/users/"+o[a]).then(function(e){var o=e.data;t.members.push(o)})}}}]),angular.module("mainApp").service("generalService",["$http",function(e){this.modifyArr=function(e){for(var t=[],o=0;o<=e.length-1;){for(var n={events:[]},a=0;a<3;a++)e[o]&&n.events.push(e[o]),o+=1;t.push(n)}return t}}]),angular.module("mainApp").service("multipartForm",["$http","cookieService","$location",function(e,t,o){this.post=function(n,a){var r=new FormData;for(var i in a)r[i]=a[i];var c=t.getCookie("email");e.post("/api/events/",{name:r.name,description:r.description,payment:r.payment,place:r.place,type:r.type,date:r.dt,time:r.time,creator:c,members:"",photoURL:r.photoURL}),o.url("/home")}}]);